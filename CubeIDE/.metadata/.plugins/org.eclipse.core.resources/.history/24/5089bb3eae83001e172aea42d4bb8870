/*
 * Ultrasonic.c
 *
 *  Created on: Nov 9, 2023
 *      Author: Ahmed
 */



#include "HAL/Ultrasonic.h"
#include "HAL/DC_MOTOR.h"


extern TIM_HandleTypeDef htim2;
uint32_t pMillis;
uint32_t val1_Ultrsonic_1 = 0;
uint32_t val2_Ultrsonic_1 = 0;
uint32_t val1_Ultrsonic_2 = 0;
uint32_t val2_Ultrsonic_2 = 0;
uint32_t val1_Ultrsonic_3 = 0;
uint32_t val2_Ultrsonic_3 = 0;
uint32_t val1_Ultrsonic_4 = 0;
uint32_t val2_Ultrsonic_4 = 0;

uint16_t distance1 = 0;
uint16_t distance2 = 0;
uint16_t distance3 = 0;
uint16_t distance4 = 0;


UltrasonicSensor ultrasonicSensors[ULTRA_COUNT] = {
    {GPIOA, GPIOA, GPIO_PIN_0, GPIO_PIN_4, &val1_Ultrsonic_1, &val2_Ultrsonic_1, &distance1},
    {GPIOB, GPIOB, GPIO_PIN_0, GPIO_PIN_1, &val1_Ultrsonic_2, &val2_Ultrsonic_2, &distance2},
    {GPIOB, GPIOB, GPIO_PIN_13, GPIO_PIN_14, &val1_Ultrsonic_3, &val2_Ultrsonic_3, &distance3},
    {GPIOA, GPIOB, GPIO_PIN_15, GPIO_PIN_15, &val1_Ultrsonic_4, &val2_Ultrsonic_4, &distance4}
};

void HAL_voidUltraSonicInit(void) {
    HAL_TIM_Base_Start(&htim2);
}


void HAL_voidUltraSonic (uint16_t *UltraSonic_Reading)
{


/* TODO  ****************/

}

uint8_t HAL_UltraSonic_Decision(uint16_t *UltraSonic_Reading)
{

	uint8_t Return_Value = 254 ;

	/* About to Hit */
	if ( (10 <= UltraSonic_Reading[0]) &&  (UltraSonic_Reading[0]<= 20) )
	{
		Return_Value = STOP ;

	}

	/* Close to Hit */
	else if ((20 < UltraSonic_Reading[0]) &&  (UltraSonic_Reading[0]<= 30) )
	{
		Return_Value = SPEED_25 ;

	}



	return Return_Value ;

}
